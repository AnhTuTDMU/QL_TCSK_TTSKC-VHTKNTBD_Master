@model IEnumerable<QL_ToChucSuKien_TTSKCĐVHTKNTBD_Master.Models.EventsModel>
@{
    ViewData["Title"] = "Danh sách sự kiện";
    Layout = "~/Areas/Admin/Shared/_LayoutAdmin.cshtml";
}

<h2>Sự kiện đang diễn ra</h2>

@{
    if (User.IsInRole("Trưởng phòng"))
    {
                <a href="#" id="btnOpenCreateModal" class="btn btn-success m-2">Tạo mới sự kiện</a>
    }
}


<table id="eventsTable" class="table table-striped table-bordered display" style="text-align: center;">
    <thead class="thead-dark">
        <tr>
            <th>Ảnh</th>
            <th>Tên sự kiện</th>
            <th>Ngày bắt đầu</th>
            <th>Ngày kết thúc</th>
            <th>Địa điểm</th>
            <th>Thao tác</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td style="vertical-align: middle;">
                    <img src="@item.ImgUrl" style="width: 75px; height: 75px; object-fit: cover; border-radius: 50%;" />
                </td>
                <td style="vertical-align: middle;">@Html.DisplayFor(modelItem => item.EventName)</td>
                <td style="vertical-align: middle;">@item.EventStartDate.ToString("dd/MM/yyyy HH:mm")</td>
                <td style="vertical-align: middle; width: 140px;">@item.EventEndDate.ToString("dd/MM/yyyy HH:mm")</td>
                <td style="vertical-align: middle;">@Html.DisplayFor(modelItem => item.EventLocation)</td>
                <td style="vertical-align: middle; width:190px">
                    @{
                        if (User.IsInRole("Trưởng phòng"))
                        {
                                    <div style="margin-bottom: 5px;">
                                        <a href="#" class="btn btn-primary btn-block edit-link" data-id="@item.EventID" title="Edit">
                                            <i class="fas fa-edit"></i> Chỉnh sửa
                                        </a>
                                    </div>
                                    <div style="margin-bottom: 5px;">
                                        <a href="#" class="btn btn-danger btn-block delete-link" data-id="@item.EventID" title="Delete">
                                            <i class="fas fa-trash-alt"></i> Xóa
                                        </a>
                                    </div>
                        }
                    }
                    <div>
                        <a href="@Url.Action("RegistrationList", "Events", new { eventId = item.EventID })" class="btn btn-success btn-block" title="Xem đăng ký">
                            <i class="fas fa-eye"></i> Xem đăng ký
                        </a>
                    </div>
                </td>


            </tr>
        }
    </tbody>
</table>


<!-- Modal -->
<div class="modal fade" id="createEventModal" tabindex="-1" role="dialog" aria-labelledby="createEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createEventModalLabel">Tạo mới sự kiện</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="createEventModalContent"></div>
            </div>
        </div>
    </div>
</div>
<script src="~/js/Events.js"></script>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            // Sự kiện click vào nút "Tạo mới sự kiện"
            $('#btnOpenCreateModal').click(function () {
                openModal('@Url.Action("Create", "Events", new { area = "Admin" })');
            });

            // Sự kiện click vào nút "Lưu" trong form "Tạo mới sự kiện"
            $(document).on('click', '#btnCreateEvent', function () {
                var formData = new FormData($('#createEventForm')[0]);
                ajaxPost('@Url.Action("Create", "Events")', formData);
            });

            // Sự kiện click vào nút "Chỉnh sửa" của một sự kiện
            $(document).on('click', '.edit-link', function () {
                var eventId = $(this).data('id');
                openModal('@Url.Action("Edit", "Events", new { area = "Admin" })?id=' + eventId);
            });

            // Sự kiện click vào nút "Lưu" trong form "Chỉnh sửa sự kiện"
            $(document).on('click', '#btnSaveEvent', function () {
                var formData = new FormData($('#editEventForm')[0]);
                var eventId = $('input[name="EventID"]').val();
                ajaxPost('@Url.Action("Edit", "Events")/' + eventId, formData);
            });

            // Sự kiện click vào nút "Đóng" trong modal
            $(document).on('click', '[data-dismiss="modal"]', function () {
                $('#createEventModal').modal('hide');
            });

            // Xử lý sự kiện click xóa sự kiện
            $('.delete-link').click(function () {
                if (confirm('Bạn có chắc chắn muốn xóa sự kiện này?')) {
                    var eventId = $(this).data('id');
                    ajaxPost('@Url.Action("Delete", "Events", new { area = "Admin" })/' + eventId, {});
                }
            });
        
        });

            function previewImage(input) {
                var preview = document.getElementById('imagePreview');
                var file = input.files[0];

                if (file) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    }

                    reader.readAsDataURL(file);
                }
            }
        $(document).ready(function () {
            $('#eventsTable').DataTable({
                "language": {
                    "url": "https://cdn.datatables.net/plug-ins/1.11.5/i18n/vi.json"
                },
                "paging": true,
                "ordering": true,
                "info": true,
                "pageLength": 10,
                layout: {
                    topStart: {
                        buttons: [
                            {
                                extend: 'copy',
                                text: '<i class="fas fa-copy"></i> Sao chép',
                                className: 'btn btn-primary'
                            },
                            {
                                extend: 'csv',
                                text: '<i class="fas fa-file-csv"></i> CSV',
                                className: 'btn btn-primary'
                            },
                            {
                                extend: 'excel',
                                text: '<i class="fas fa-file-excel"></i> Excel',
                                className: 'btn btn-success'
                            },
                            {
                                extend: 'pdf',
                                text: '<i class="fas fa-file-pdf"></i> PDF',
                                className: 'btn btn-danger'
                            },
                            {
                                extend: 'print',
                                text: '<i class="fas fa-print"></i> In',
                                className: 'btn btn-info'
                            }
                        ]
                    }
                }
                      
            });
        });

    </script>
}
